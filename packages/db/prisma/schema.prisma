generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RoleName {
  ADMIN
  RECEPTION
}

enum PackageStatus {
  RECEIVED
  READY_FOR_PICKUP
  DELIVERED
  RETURNED
}

enum PackageEventType {
  RECEIVED
  STATUS_CHANGE
  DELIVERED
  PRINTED
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
}

model Role {
  id    Int      @id @default(autoincrement())
  name  RoleName @unique
  users User[]
}

model User {
  id           Int       @id @default(autoincrement())
  name         String
  email        String    @unique
  passwordHash String
  roleId       Int
  role         Role      @relation(fields: [roleId], references: [id])
  active       Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  receivedPackages Package[] @relation("ReceivedBy")
  deliveredPackages Package[] @relation("DeliveredBy")
  events            PackageEvent[]
}

model Client {
  id        Int       @id @default(autoincrement())
  name      String
  phone     String?
  email     String?
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  packages  Package[]
}

model Courier {
  id        Int       @id @default(autoincrement())
  name      String
  contact   String?
  phone     String?
  notes     String?
  external  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  packages  Package[]
}

model Package {
  id               String          @id @default(cuid())
  trackingCode     String          @unique
  status           PackageStatus   @default(RECEIVED)
  courierId        Int
  courier          Courier         @relation(fields: [courierId], references: [id])
  clientId         Int
  client           Client          @relation(fields: [clientId], references: [id])
  receivedByUserId Int
  receivedBy       User            @relation("ReceivedBy", fields: [receivedByUserId], references: [id])
  deliveredByUserId Int?
  deliveredBy       User?           @relation("DeliveredBy", fields: [deliveredByUserId], references: [id])
  amountDue        Decimal?        @db.Decimal(10, 2)
  amountPaid       Decimal?        @db.Decimal(10, 2)
  paymentMethod    PaymentMethod?
  receivedAt       DateTime        @default(now())
  deliveredAt      DateTime?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  events           PackageEvent[]
  ticket           Ticket?
}

model PackageEvent {
  id        String           @id @default(cuid())
  type      PackageEventType
  packageId String
  package   Package          @relation(fields: [packageId], references: [id])
  metadata  Json?
  userId    Int?
  user      User?            @relation(fields: [userId], references: [id])
  createdAt DateTime         @default(now())
}

model Ticket {
  id               String   @id @default(cuid())
  packageId        String   @unique
  package          Package  @relation(fields: [packageId], references: [id])
  printedAt        DateTime @default(now())
  reprintCount     Int      @default(0)
  templateVersion  String?  @default("v1")
}

model DailyReport {
  id                  String   @id @default(cuid())
  date                DateTime @unique
  totalReceived       Int      @default(0)
  totalDelivered      Int      @default(0)
  totalAmountCollected Decimal? @db.Decimal(12, 2)
  createdAt           DateTime @default(now())
}
